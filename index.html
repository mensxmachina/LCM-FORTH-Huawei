<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Large Causal Models for Causal Discovery on Time Series</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="This website contains an introduction on Large Causal Models for time series.">
    <meta name="language" content="English">
    <meta name="author" content="Dario Simionato">
    
    <link rel="stylesheet" href="vocab/themes/blue/style.css" type="text/css" media="print, projection, screen" />
    <script src="vocab/js/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="vocab/js/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="vocab/js/jquery.stickytableheaders.js"></script>
    <script type="text/javascript" src="vocab/js/jquery-ui.js"></script>
    <script type="text/javascript" src="vocab/js/bootstrap.js"></script>
    <link rel="stylesheet" href="vocab/css/jquery-ui.css"></link>
    <script type="text/javascript" id="js">
        $(document).ready(function() { 
            $("#tablesorter-demo").tablesorter(); 
            $("#tablesorter-demo").stickyTableHeaders(); 
            $('[data-toggle="tooltip"]').tooltip(); 
        }); 
    </script>

    <link href="vocab/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
  </head>

  <body>

    <div class="container">
      <!-- Jumbotron -->
      <div class="jumbotron">
        <!-- <h1>Large Causal Models on Time Series</h1> -->
        <h1 style="font-size: 60px;">Large Causal Models on Time Series</h1>

        <!-- <p class="lead">This page contains an introduction on the use of Large Causal Models (LCMs) on time series data for causal discovery tasks. Such project is a collaboration between Huawei Research Ireland and Men Ex Machina group (University of Crete and FORTH).</p> -->
        <!-- <div class="row">
          <div class="col-md-12" style="display: grid; grid-template-columns: repeat(3, auto); justify-items: center; max-width: 1000px">
            <a href="https://www.forth.gr/en/home/" target="_blank">
              <img src="vocab/img/forth logo.jpg" alt="FORTH logo" class="img-fluid" style="height: 85px;"/>
            </a>
            <a href="https://ie.linkedin.com/company/huawei-ireland-research-center" target="_blank">
              <img src="vocab/img/logo-huawei.jpeg" alt="Huawei Research logo" class="img-fluid" style="height: 85px;"/>
            </a>
            <a href="https://www.uoc.gr/en/home/" target="_blank">
              <img src="vocab/img/uni crete logo.jpg" alt="University of Crete logo" class="img-fluid" style="height: 85px;"/>
            </a>
          </div>
        </div> -->
        <div class="row" style="display: flex; justify-content: center; gap: 20px;">
            <a href="https://www.forth.gr/en/home/" target="_blank" ">
              <img src="vocab/img/forth logo.jpg" alt="FORTH logo" class="img-fluid" style="height: 70px;" />
            </a>
            <a href="https://ie.linkedin.com/company/huawei-ireland-research-center" target="_blank" ">
              <img src="vocab/img/logo-huawei.jpeg" alt="Huawei Research logo" class="img-fluid" style="height: 70px;" />
            </a>
            <a href="https://www.uoc.gr/en/home/" target="_blank"">
              <img src="vocab/img/uni crete logo.jpg" alt="University of Crete logo" class="img-fluid" style="height: 70px;" />
            </a>
        </div>
        
        
        <br>
        <!-- List below the logos -->
        <div class="row">
          <div class="col-md-12 text-center">
            <ul class="list-unstyled"  style="font-size: 20px;">
              <li>Foundation for Research and Technology, Hellas (FORTH)</li>
              <li>Huawei Ireland Research Center - AIOps Team</li>
              <li>Huawei Dongguan R&D Campus</li>
            </ul>
          </div>
        </div>
        
        
      </div>
      <hr>

      <div class="row">
        <h2>Large Causal Model</h2>
        <p>
          A <strong>Large Causal Model (LCM)</strong> for causal discovery is a model that unveils the cause-and-effect relationships between variables in complex systems. These models are particularly useful for understanding how changes in one factor lead to changes in another, rather than just identifying correlations. Additionally, they help identify which variables influence others, especially in complex or high-dimensional datasets where traditional methods might miss key connections.
        </ul>
        
        <!-- <h2>Why Use a Large Causal Model?</h2>
        Large Causal Models combine the speed and flexibility of deep learning methods with the explainatory power of causal discovery methods, allowing for a fast and efficient prediction of the causal network. The output of causal discovery, in the form of a causal graph, can be used to explain algorithmic outcomes, such as identifying root causes, and to inform evidence-based decision-making, for example through counterfactual analysis. -->
      </br>
          <table id="tablesorter-demo" class="tablesorter table table-hover table-responsive">
          <!-- <table> -->
              <thead>
                <tr>
                  <th class="col-md-2">Approach</th>
                  <th class="col-md-2">Discover causal connections</th>
                  <th class="col-md-1">Fast inference</th>
                  <th class="col-md-2">Scale to large data quantity</th>
                </tr>
              </thead>
            <tbody>              
              <tr>
                <td>
                  Traditional Causal Discovery Methods                  
                </td>
                <td>Yes</td>
                <td>No</td>
                <td>No</td>
              </tr>
              <tr>
                <td>
                  Large Causal Models
                </td>
                <td>Yes</td>
                <td>Yes</td>
                <td>Yes</td>
              </tr>
            </tbody>
          </table>
          <hr>
        
        <!-- <p>
          <strong>Comparison with Traditional ML/DL Techniques:</strong><br>
          Traditional machine learning (ML) and deep learning (DL) models are excellent at predicting outcomes based on historical data, but they typically treat relationships between variables as black boxes. They identify patterns without revealing <strong>why</strong> certain events occur. In contrast, <strong>Large Causal Models</strong> allow us to identify <strong>cause-and-effect relationships</strong>, providing not only predictions but also explanations, which is essential for fields like policy-making, healthcare, and economics.
        </p>
        <p>
          <strong>Comparison with Other State-of-the-Art (SoA) Causal Models:</strong><br>
          While other causal inference methods, like <strong>Structural Equation Modeling (SEM)</strong> or <strong>Propensity Score Matching (PSM)</strong>, are valuable, they often struggle with scalability and handling complex, high-dimensional data. Large causal models, on the other hand, are designed to scale efficiently with large datasets and uncover interactions between many variables at once. They also offer better robustness in estimating effects and identifying causal structures compared to traditional approaches.
        </p> -->
        <h2>How does it work?</h2>
        <p>
          The LCM takes as input a dataset of time series and automatically predicts the full-time graph representing the causal relationships between the time series over a time window period. Such graph is then condensed in a simpler representation, the summary graph, in which each time series is represented as a node, and each discovered cause-effect relationship is represented as a directed link.
        </p>
        <div class="text-center">
          <img src="vocab/img/pipeline.png" alt="Prediction Pipeline" class="img-squared" class="img-responsive" style="height:250px;" />
        </div>

        <h2>Try it yourself!</h2>

        <h4>0. Setup</h4>
        <p>The setup phase is divided into three steps:</p>
        <ul>
          <li>Download the code at <a href="https://github.com/mensxmachina/LCM-FORTH-Huawei" target="_blank">https://github.com/mensxmachina/LCM-FORTH-Huawei</a></li>
          <li>Install the required dependencies in <code>requirements.txt</code> (e.g. with <code>pip install -r requirements.txt</code>)</li>
          <li>Download the pretrained model weights and save them under the <code>res/</code> folder</li>
        </ul>
        
        <p>Currently, two pretrained LCM models of different sizes are available:</p>
        <ul>
          <li><code>deep_CI_12_3_fine_tuned_frozen_sim_82k_pre_joint_220k</code><b>(210 MB Small): <a href="https://onebox.huawei.com/p/8cc0be09bfd68373ba262382f6c2d9dd" target="_blank">download link</a>(external link will be available soon)</b></li>
          <li><code>lcm_CI_RH_12_3_merged_290k</code><b>(4.6 GB Large): <a href="https://onebox.huawei.com/p/7cfe822b2fa5594b04d62403e5f90a38" target="_blank">download link</a> (external link will be available soon) </b></li>
        </ul>
        
        <h4>1. Import the Required Libraries</h4>
        <p>At first, import the necessary modules for data generation, model prediction, and result visualization:</p>
        <pre><code>
        from pathlib import Path
        from utils.model_wrapper import Architecture_PL
        from utils.cp_utils import set_seed, create_example_data, run_cp_and_parse_res
        from utils.plotting_utils import plot_summary_from_pred
        </code></pre>
        
        <h4>2. Load the Data</h4>
        <p>
          The LCM takes as input a temporal dataset of shape <code>(N, D)</code> where <strong>N</strong> is the sample size and <strong>D</strong> the feature size (number of time-series). In this example, we generate synthetic data with 1000 time samples, where each column represents a different time series. Data are Min-max normalized and random seed set to <code>42</code> for reproducibility.
        </p>
        
        <pre><code>
        set_seed(42)
        
        df = create_example_data(n=1000)
        variable_names = list(df.columns)
        </code></pre>
        
        <h4>3. Load the Pretrained Model</h4>
        <p>Load the <code>.ckpt</code> pretrained model for causal prediction:</p>
        <pre><code>
        models_path = 'res'
        model_name = 'lcm_CI_RH_12_3_merged_290k'
        
        model = Architecture_PL.load_from_checkpoint(Path(models_path) / f"{model_name}.ckpt")
        </code></pre>
        
        <h4>4. Perform Causal Discovery</h4>
        <p>Run <code>run_cp_and_parse_res</code> to perform causal discovery on the data. The <code>max_lag</code> parameter specifies the maximum time window size for analyzing causal relationships:</p>
              
        <pre><code>
        # Run causal discovery with a maximum lag of 2
        pred = run_cp_and_parse_res(model_name, model=model, df=df, max_lag=2, seed=42)
        </code></pre>
        
        <p>The result is a lagged adjacency tensor of shape <code>(N, N, max_lag)</code> where:</p>
        <ul>
          <li><strong>N</strong> is the number of input time-series</li>
          <li><code>pred[i, j, k]</code> represents the probability that the <strong>j</strong>-th time-series at time <strong>t-(max_lag - k)</strong> causes the <strong>i</strong>-th time-series at time <strong>t</strong>.</li>
        </ul>
        
        <h4>5. Visualize the Results</h4>
        <p>The predicted causal relationships can be visualized using <code>plot_summary_from_pred</code>. The <code>plt_thr</code> parameter controls the density of the graph: higher values result in fewer edges being displayed.</p>
        <pre><code>
        plot_summary_from_pred(pred, variable_names, plt_thr=0.5)
        </code></pre>
        
        <p>In the resulting graph, an edge from time series A to B marked as <code>t-1</code> means that time series A at time <strong>t-1</strong> caused time series B at time <strong>t</strong>.</p>
        <div class="text-center">
          <img src="vocab/img/summary.png" alt="Output plot of the summary graph." style="height:250px;"/>
        </div>

      <h2>Paper</h2>
      <p>Comming soon</p>
      
      <h2>Assumptions and Limitations of current model </h2>
      <p>
        The last version of the LCMs works under the current assumptions:
      </p>
      <ul>
        <li><strong>Causal Markov Condition and Faithfulness</strong>: These assumptions imply that the causal structure of the system fully captures the dependencies among the variables and that the observed data conforms to the causal relationships described by the model.</li>
        <li><strong>Causal Inference of up to 12 Variables and 3 Time Lags</strong>: The models can handle inputs up to 12 variables and up to 3 time lags.</li>
        <li><strong>No Contemporaneous Effects</strong>: We assume that all cause-effect relationships occur after at least one time lag, meaning that there are no contemporaneous effects where variables influence each other at the same time step.</li>
        <li><strong>No Unobserved Confounders</strong>: The model relies on the assumption that all relevant causes are observable and accounted for.</li>
        <li><strong>Causal Stationarity</strong>: The relationships between variables and their influences do not evolve or change in different time periods.</li>
        <li><strong>Time-Series Stationarity</strong>: The input time-series data are assumed to be stationary, meaning their statistical properties, such as mean and variance, do not change over time.</li>
      </ul>
      
      <!-- <footer class="footer">
        <div class="row">
          <div class="col-md-3">
           Built with <a target="_blank" href="https://getbootstrap.com/">Bootstrap</a><br>
            Latest revision February, 2025 -->
          <!-- </div>
          <div class="col-md-9">
            <a href="https://www.forth.gr/en/home/" target="_blank"><img src="vocab/img/forth logo.jpg" alt="FORTH logo" class="img-squared" class="img-responsive "/></a>
            <a href="https://ie.linkedin.com/company/huawei-ireland-research-center" target="_blank"><img src="vocab/img/logo-huawei.jpeg" alt="Huawei Research logo" class="img-squared" class="img-responsive "/></a>
            <a href="https://www.uoc.gr/en/home/" target="_blank"><img src="vocab/img/uni crete logo.jpg" alt="University of Crete logo" class="img-squared" class="img-responsive "/></a>
          </div>
          Built with <a target="_blank" href="https://getbootstrap.com/">Bootstrap</a><br>
          Latest revision February, 2025
        </div>
      </footer> --> 
    </div> <!-- /container -->

  </body>
</html>
